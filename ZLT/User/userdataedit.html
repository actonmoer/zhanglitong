<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>会员资料修改</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_330648_2vxyeo24dmuf2yb9.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/user.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="../js/myjs.js"></script>
    <style type="text/css">
        #filePicker input[type=file]{
            height: 5rem;
            width: 5rem;
        }
        .webuploader-pick{
            height: 5rem;
            width: 5rem;
        }
        #isSelect,#isModifyInput{
            position: absolute;
            left: 100%;
            top: 0;
            bottom: 0;
            background-color: #f2f2f2;
            width: 100%;
            transition: left .5s;
            z-index: 1;
        }
        #isSelect li{
            background-color: #fff;
            height: 40px;
            line-height: 40px;
            padding: 0 20px;
            border-bottom: 1px solid #d3d3d3;
            font-size: 16px;
        }
        #isSelect li i{
            font-size: 14px;
        }
        .sexHead{
            height: 3rem;
            display: flex;
            display: -webkit-flex;
            width: 100%;
        }
        .sexHead>div{
            text-align: center;
            background-color: #3d95e5;
        }
        .sexHead>div:nth-child(1){
            width: 20%;
        }
        .sexHead>div:nth-child(3){
            width: 20%;
        }
        .sexHead>div:nth-child(2){
            width: 60%;
            line-height: 3rem;
            color: #fff;
            font-size: 1.125rem;
        }
    </style>
</head>
<body style="background-color: #f2f2f2;overflow: hidden;">
<header></header>
<section style="display: none;">
    <div class="m20-t bfff">
        <ul class="user-msg">
            <li class="m20-l">
                <div class="m20-r">
                    <div class="clearb" style="padding:1.25rem 0;position: relative;">
                        <span class="u-msg-span" style="height: 5rem;display: inline-block;line-height: 5rem;">头像</span>
                        <a href="javascript:;" class="fr" style="height: 5rem;"><img class="bor-img" src="../img/default.png" alt=""></a>
                        <a id="filePicker" href="/member/avatar.php" style="height: 5rem;width: 5rem; position: absolute;right: 0;z-index: 1;opacity: 0;"></a>
                        <!--<form action="/member/avatar.php" method="post" enctype="multipart/form-data" onsubmit="return check()">-->
                            <!--<input type="hidden" name="action" value="upload"/>-->
                            <!--<input type="file" name="upfile" id="upfile" class="avatar_file" onchange="this.form.submit()" />-->
                        <!--</form>-->
                        <!--<input type="file" id="filePicker" value="" name="file" accept="image/jpeg,image/x-png">-->
                    </div>
                </div>
            </li>
            <li class="m20-l">
                <div class="m20-r">
                    <div class="clearb" style="padding:1.25rem 0;">
                        <span class="u-msg-span">昵称</span>
                        <span class="fr" id="truename" onclick="modifyInput(this,'修改昵称')" style="color: #666;font-size: .75rem;padding-left:20px;"></span>
                    </div>
                </div>
            </li>
            <li class="m20-l">
                <div class="m20-r">
                    <div class="clearb" style="padding:1.25rem 0;">
                        <span class="u-msg-span">会员名</span>
                        <span class="fr" id="username" style="color: #666;font-size: .75rem;padding-left:20px;"></span>
                    </div>
                </div>
            </li>
            <li class="m20-l">
                <div class="m20-r">
                    <div class="clearb" style="padding:1.25rem 0;">
                        <span class="u-msg-span" id="sexid">性别</span>
                        <span id="sex" onclick="document.getElementById('isSelect').style.left='0'" class="fr" style="color: #666;font-size: .75rem;padding-left:20px;"></span>
                        <input id="sexinput" type="hidden" name="sex" value="">
                    </div>
                </div>
            </li>
            <!--<li class="m20-l">-->
                <!--<div class="m20-r">-->
                    <!--<div class="clearb" style="padding:1.25rem 0;">-->
                        <!--<span id="tips-m" class="u-msg-span">信息提示音</span>-->
                        <!--<span id="tips" class="fr" style="color: #666;font-size: .75rem;" onclick="modifyMusic(this)">音效1</span>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</li>-->
        </ul>
    </div>
    <div class="m20-lr m20-t"><input type="button" onclick="loginOut()" class="u-btn btn" value="退出登录"></div>
</section>
<footer></footer>
<div id="isSelect">
    <div class="sexHead">
        <div><a onclick="document.getElementById('isSelect').style.left=100+'%'" class="h-L-a"><i class="iconfont icon-left icon-return"></i></a></div>
        <div>修改性别</div>
        <div></div>
    </div>
    <ul>
        <li val="1" onclick="getSex(this)">男<i class="iconfont icon-right fr"></i></li>
        <li val="2" onclick="getSex(this)">女<i class="iconfont icon-right fr"></i></li>
    </ul>
</div>
<div id="isModifyInput">
    <div class="sexHead">
        <div><a onclick="hideInput()" class="h-L-a"><i class="iconfont icon-left icon-return"></i></a></div>
        <div class="inputHead"></div>
        <div></div>
    </div>
    <div style="padding: 20px;background-color: #fff;">
        <div class="modifyName"></div>
        <div style="margin-top: 20px;">
            <input type="button" class="btn btn-primary" onclick="modifyUser()" style="width: 100%;background-color: #3d95e5;" value="确定">
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function(){
        $("body").append(footNav());
        footState(3);
        $.ajax({
            url: "../ZLT/head.html",
            type: "GET",
            success: function(d){
                $("header").html(d);
                $(".h-C").html("修改资料");
                $(".h-L").html("<a href='javascript:HistoryURL();' class='h-L-a'><i class='iconfont icon-left icon-return'></i></a>")
                $("section").show();
            },
            error: function(d){
                alert("网络延时，请稍后再试!");
                HistoryURL();
            }
        });
//        $.ajax({
//            url: "../ZLT/foot.html",
//            type: "GET",
//            success: function(d){
//                $("footer").html(d);
//                footState(3);
//            },
//            error: function(d){
//                alert("网络延时，请稍后再试!");
//                HistoryURL();
//            }
//        });
        $.ajax({
            url: "../usercenter.php",
            type: "POST",
            data: {action:"mymassage"},
            dataType: "JSON",
            success: function(d){
                if(d.code == 200){
                    $(".bor-img").attr("src","/api/avatar/show.php?username="+d.data.username+"&size=large");
                    $("#truename").html(d.data.truename);
                    $("#username").html(d.data.username);
                    if(d.data.gender == 1){
                        $("#sex").html("男");
                        $("input[name='sex']").val(d.data.gender);
                    }else{
                        $("#sex").html("女");
                        $("input[name='sex']").val(d.data.gender);
                    }
                }
            },
            error: function(d){
                alert("网络延时，请稍后再试!");
                HistoryURL();
            }
        });
    });
    //修改性别
    function getSex(s){
        var i = $("#sexinput").val(s.getAttribute("val"));
        if(s.getAttribute("val") == 1){
            $("#sex").html("男");
        }else if(s.getAttribute("val") == 2){
            $("#sex").html("女");
        }
        $("#isSelect").css("left","100%");
    }
    //修改昵称、会员名
    function modifyInput(s, value){
        $("#isModifyInput").css("left",0);
        if(value == '修改昵称'){
            $(".modifyName").html('<input type="text" class="form-control" name="truename" value="'+$(s).html()+'" placeholder="修改昵称">');
        }else if(value == '修改会员名'){
            $(".modifyName").html('<input type="text" class="form-control" name="username" value="'+$(s).html()+'" placeholder="修改会员名">');
        }
        $(".inputHead").html(value);
    }
    function hideInput(){
        $("#isModifyInput").css("left","100%");
        setTimeout(function(){
            $("#isModifyInput").find("input[type='text']").remove();
        },500);
    }

    function modifyUser(){
        var inp = $(".modifyName").find("input");
        var obj={};
        if(inp.val().trim()){
            if(inp[0].name == "truename"){
                obj={action:"edit_truename",truename:inp.val()};
            }else{
                obj={action:"edit_truename",username:inp.val()};
            }
            $.ajax({
                url: "../usercenter.php",
                type: "POST",
                data: obj,
                dataType: "JSON",
                success: function(d){
                    console.log(d);
                    if(d.code == 200){
                        hideInput();
                        if(obj.truename){
                            $("#truename").html(inp.val());
                        }else if(obj.username){
                            $("#username").html(inp.val());
                        }
                    }
                },
                error: function(d){
                    alert("网络延时，请稍后再试!");
                    hideInput();
                }
            });
        }else{
            alert("不能为空");
            inp.val("");
        }
    }
</script>
</body>
</html>