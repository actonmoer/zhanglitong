<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>确认订单</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_n95cwd7bt77xecdi.css">
    <link rel="stylesheet" href="../css/style.css">
    <style type="text/css">
        /*shoppingCart-empty*/
        .shoppingCart{
            margin:0 auto;
            text-align:center;
        }
        .shoppingCart p i {
            font-size:4.875rem;
            color:#3d95e5;
            margin-top:4rem;
        }
        .shoppingCart p:nth-child(2){
            font-size:.875rem;
            margin:1.25rem 0 .875rem;
        }
        .shoppingCart p:nth-child(3){
            font-size:.75rem;
            color:#666;
        }
        .white-btn {
            background-color: #fff;
            color: #333;
            font-size: 1rem;
            height: 3.125rem;
            box-shadow: 0 2px 4px 0 rgba(51, 51, 51, 0.1);
        }
        /*shoppingCart-order*/
        .shoppingCart-order{
            margin-top:1.25rem;
            background-color:#fff;
            padding:0 1.25rem;
        }
        .shoppingCart-title{
            border-bottom:1px solid #f2f2f2;
            padding:1.375rem 0 .75rem;
            font-size:.875rem;
        }
        .shoppingCart-title .right {
            float:right;
            color:#3d95e5;
        }
        .shoppingCart-center {
            position:relative;
            height:6.25rem;
            border-bottom:1px solid #f2f2f2;
        }
        .shoppingCart-icon {
            position:absolute;
            height:6.25rem;
            padding:2.625rem .4375rem;
        }
        .shoppingCart-img {
            position:absolute;
            top:1.25rem;
            left:1.875rem;
            width:3.75rem;
            height:3.75rem;
            background-color:#f2f2f2;
        }
        .shoppingCart-number {
            position:absolute;
            height:3.75rem;
            top:1.25rem;
            left:6.25rem;
        }
        .shoppingCart-number p:first-child i{
            color:#3d95e5;
            font-size:1.25rem;
            font-weight:bold;
        }
        .shoppingCart-number p:first-child span{
            display:inline-block;
            width:2.5rem;
            text-align:center;
            border-bottom:1px solid #3d95e5;
            margin:0 .3125rem;
        }
        .shoppingCart-number p:last-child {
            font-size:.75rem;
            color:#666;
            padding-top:1.6875rem;
        }
        .shoppingCart-number p:last-child i{
            float:right;
        }
        .shoppingCart-btn {
            position:absolute;
            top:0;
            right:0;
            height:6.25rem;
            line-height:6.25rem;
            width:3.75rem;
            background-color:#3d95e5;
            text-align:center;
            color:#fff;
        }
        .shoppingCart-tip {
            padding:.625rem 0 1.25rem;
            font-size:.75rem;
            color:#666;
        }
        .shoppingCart-amount{
            position:absolute;
            height:3.75rem;
            top:1.25rem;
            right:0;
            width:100%;
            padding-left:6.25rem;
        }
        .shoppingCart-amount p:nth-child(1) {
            font-size:.875rem;
        }
        .shoppingCart-amount p:nth-child(2) {
            font-size:.625rem;
            color:#666;
            margin:.375rem 0;
        }
        .shoppingCart-amount p:nth-child(3) span:nth-child(1){
            font-size:.875rem;
            color:#f0790f;
        }
        .shoppingCart-amount p:nth-child(3) span:nth-child(2){
            font-size:.875rem;
            color:#333;
            float:right;
        }
        footer{
            position:fixed;
            width:100%;
            height:3.125rem;
            bottom:0;
            border-top:1px solid #d3d3d3;
            background-color:#fff;
        }
        .foot-select{
            height:3.125rem;
            font-size:.875rem;
            padding:1.0625rem 0 1.0625rem 1.25rem;
        }
        .foot-select i {
            margin-right:.25rem;
        }
        .foot-select span {
            color:#666;
        }
        .foot-amount{
            position:absolute;
            top:0;
            right:7.25rem;
            font-size:.625rem;
        }
        .foot-amount p {
            height:1.375rem;
            line-height:1.375rem;
        }
        .foot-amount p:first-child span:nth-child(2){
            font-size:1rem;
            color:#f0790f;
        }
        .foot-amount p:nth-child(2) span{
            color:#666;
            float:right;
        }
        .foot-btn{
            position:absolute;
            top:0;
            right:0;
            width:6.625rem;
            height:3.125rem;
            line-height:3.125rem;
            text-align:center;
            font-size:.875rem;
            color:#fff;
            background-image:linear-gradient( 130deg,rgb(61,195,229) 0%,rgb(61,149,229) 100%);
        }
        .checked {
            display:inline-block;
            width:1rem;
            height:1rem;
            background-color:#3d95e5;
            color:#fff;
        }
        .no-checked {
            display:inline-block;
            width:1rem;
            height:1rem;
            border:1px solid #d3d3d3;
            color:#fff;
        }
        /*shoppingCart-confirm*/
        .order-message {
            position:relative;
            margin-top:1.25rem;
            background-color:#fff;
            padding:0 1.25rem;
            font-size:.875rem;
        }
        .order-message a.address{
            display: block;
            text-align: center;
            padding: 1.25rem 0;
        }
        .order-address {
            margin-right:1.875rem;
        }
        .order-address p:nth-child(1){
            padding:1.25rem 0 .625rem 0;
        }
        .order-address p:nth-child(2){
            color:#666;
            line-height:1.25rem;
            padding-bottom:1rem;
        }
        .order-icon{
            position:absolute;
            top:0;
            right:1.25rem;
            width:1.875rem;
            height:6.25rem;
            line-height:6.25rem;
            text-align:right;
        }
        .order-icon i{
            font-size:.875rem;
        }
        .order-details {
            margin-top:1.25rem;
            margin-bottom:4.375rem;
            padding:0 1.25rem;
            background-color:#fff;
            font-size:.875rem;
            color:#666;
        }
        .shop-name {
            border-bottom:1px solid #f2f2f2;
            overflow: hidden;
            height: 2.5rem;
        }
        .shop-name i {
            display:inline-block;
            width:1.25rem;
            height:1.25rem;
            border-radius:50%;
            vertical-align:middle;
            margin-right:.625rem;
            text-align: center;
            line-height: 1.25rem;
        }
        .shop-name span {
            display: inline-block;
            height:2.5rem;
            line-height:2.5rem;
            color:#333;
        }
        .goods-name {
            border-bottom:1px solid #f2f2f2;
            padding:.625rem 0;
        }
        .goods-name p{
            padding: 4px 0;
        }
        .goods-name p span:nth-child(1){
            font-size:.625rem;
        }
        .goods-name p span:nth-child(2){
            float:right;
        }
        .distribution-money,.discount-money,.remark {
            height:3.25rem;
            line-height:3.25rem;
            border-bottom:1px solid #f2f2f2;
        }
        .remark{
            position:relative;
            border-bottom:1px solid #f2f2f2;
        }
        .remark div {
            position:absolute;
            top:0;
            right:0;
            width:100%;
            padding-left:2.75rem;
        }
        .remark div input{
            height:2.5rem;
            width:100%;
            border:none;
        }
        .amount {
            height:3.375rem;
            line-height:3.375rem;
            text-align:right;
        }
        .amount p span:nth-child(1){
            color:#333;
        }
        .amount p span:nth-child(2){
            color:#f28f49;
        }
        .right{
            float:right;
            color:#333;
            font-size:1rem;
        }
        /*shoppingCart-pay*/
        .pay-way {
            margin-top:1.25rem;
            padding:0 1.25rem;
            background-color:#fff;
        }
        .choose p{
            font-size:.875rem;
            height:3.25rem;
            line-height:3.25rem;
            border-bottom:1px solid #f2f2f2;
        }
        .choose p span:nth-child(3){
            float:right;
        }
        .choose p span:nth-child(2){
            color:#f0790f;
            float:right;
        }
        .pay-container {
            position:relative;
            height:4.875rem;
            border-bottom:1px solid #f2f2f2;
        }
        .pay-icon{
            position:absolute;
            left:0;
            height:4.87rem;
            line-height:4.875rem;
            color:#6eb0ec;
        }
        .pay-type{
            position:absolute;
            top:0;
            left:1.875rem;
            height:4.875rem;
        }
        .pay-type p:nth-child(1){
            font-size:.875rem;
            margin:1.25rem 0 .375rem 0;
        }
        .pay-type p:nth-child(2){
            font-size:.75rem;
            color:#666;
            margin-bottom:1.25rem;
        }
        .pay-checked {
            position:absolute;
            height:4.87rem;
            line-height:4.875rem;
            right:0;
            width:2.5rem;
            text-align:right;
        }
        .pay-checked span{
            position:relative;
            display:inline-block;
            width:1rem;
            height:1rem;
            border:1px solid #bcbcbc;
            border-radius:50%;
        }
        .pay-checked span i{
            position:absolute;
            display:inline-block;
            top:.09375rem;
            left:.09375rem;
            width:.625rem;
            height:.625rem;
            border-radius:50%;
            text-align:center;
            background-color:#fff;
        }
        .pay-checked input:checked+span {
            border-color:#3d95e5;
        }
        .pay-checked input:checked+span>i {
            background-color:#3d95e5;
        }
        .pay-checked label{
            display:inline-block;
            width:2.5rem;
        }
        /*shoppingCart-success*/
        .blue-btn {
            background-color:#3d95e5;
            color:#fff;
            font-size:1rem;
            height:3.125rem;
            box-shadow:0 2px 4px 0 rgba(51, 51, 51, 0.1);
        }


        .order-number{
            font-size: .875rem;
            color: #333;
            height: 3.25rem;
            line-height: 3.25rem;
        }
        .order-state{
            color: #f0790f;
            font-size: .75rem;
            height: 3.25rem;
            line-height: 3.25rem;
        }
        .order-link{
            display: block;
            position: relative;
            padding: 1.125rem 0 1.125rem 4.375rem;
        }
        .order-shop-img{
            width: 3.75rem;
            height: 3.75rem;
            border-radius: 100%;
            position: absolute;
            left: 0;
            top: 1.1875rem;
        }
        .order-shop{
            font-size: .875rem;
            color: #333;
            margin-bottom: .5rem;
        }
        .order-time,.order-price{
            font-size: .75rem;
            color: #666;
        }
        .order-time{
            margin-bottom: .375rem;
        }
        .all-btn{
            display: inline-block;
            font-size: .875rem;
            color: #3d95e5;
            border: 1px solid #3d95e5;
            border-radius: .25rem;
            /*padding: .6875rem 1.25rem;*/
            margin-left: .3125rem;
            width: 5rem;
            height: 1.875rem;
            text-align: center;
            line-height: 1.875rem;
        }
        .all-btn:focus{
            color: #3d95e5;
        }
        .all-btn2{
            letter-spacing: .5rem;
            /*padding: .6875rem 1.375rem .6875rem 1.875rem;*/
            padding-left: .625rem;
        }
        .order-content{
            margin-bottom: 1.25rem;
        }
        .order-item{
            padding: 10px 0;
        }
        .order-item-li{
            line-height: 1.9375rem;
        }
        .order-discount-msg{
            line-height:1.5625rem;
        }
        .order-contact-way{
            height: 2.5rem;
            text-align: center;
        }
        .order-btn:focus{
            color:#fff;
        }
        .order-btn2:focus{
            color:#333;
        }
        .order-btn{
            width: 100%;
            font-size:1rem;
            height: 3.125rem;
            color:#fff;
            background-color: #3d95e5;
        }
        .order-btn2{
            color:#333;
            background-color:#fff;
            box-shadow: 0 2px 4px 0 rgba(51, 51, 51, 0.1);
            letter-spacing: .75rem;
            padding-left: 1.5rem;
        }
        .pay-container .pay-label{
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4.875rem;
            z-index: 1;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body style="background-color: #f2f2f2;">
<header>
    <div class="head">
        <div class="h-L"><a href="javascript:window.history.go(-1);" class="h-L-a"><i class="iconfont icon-left" style="color: #fff;"></i></a></div>
        <div class="h-C">确认订单</div>
        <div class="h-R"></div>
    </div>
</header>
<section>
    <div class="order-message"></div>

    <div class="order-details">
        <!--<div class="shop-name"><i class="iconfont icon-shangpu"></i><span>店铺名称</span></div>-->
        <!--<div class="goods-name"></div>-->
        <!--<div class="distribution-money clearb">-->
            <!--<p><span>配送费</span><span class="right">￥0.00</span></p>-->
        <!--</div>-->
        <!--<div class="discount-money clearb">-->
            <!--<p><span>优惠金额</span><span class="right">￥0.00</span></p>-->
        <!--</div>-->
        <!--<div class="remark">-->
            <!--<span>备注：</span>-->
            <!--<div>-->
                <!--<input type="text" placeholder="请在此填写需要备注的信息">-->
            <!--</div>-->
        <!--</div>-->
        <!--<div class="amount">-->
            <!--<p><span>共3件商品，小计</span><span>￥999.00</span></p>-->
        <!--</div>-->
    </div>
    <footer>
        <div class="foot-amount clearb">
            <p style="height:3.125rem;line-height:3.125rem;"><span>合计：</span><span id="allPrice"></span></p>
        </div>
        <div class="foot-btn" onclick="submitOrder()">
            <span>提交订单</span>
        </div>
    </footer>
</section>
<script type="text/javascript" src="/mobile/js/myjs.js"></script>
<script type="text/javascript">
    var price = 0, num = 0, obj = strUrl(), id = obj.id, payType = obj.type, home = obj.home, name = '', phone = '';
    $(document).ready(function(){
        if(payType == 'takeout'){
            $.ajax({
                url: "/mobile/takeout.php",
                data: {act:'takeout_order_add',id:id,new_takeout:true},
                dataType: "JSON",
                success: function(d){
                    console.log(d);
                    if(d.code == 200){
                        price = d.data.detail_cash;
                        num = d.data.num;
                        name = d.lists.truename;
                        phone = d.lists.mobile;
                        address = d.lists.address;
                        $('.order-message').html(addressShow(d.lists));
                        $('.order-details').html(showDetails(d.takeout_shop, d.subsidy, home));
                        $('.goods-name').html(showMenuList(d.data));
                        $("#allPrice").html('￥'+parseFloat(price - d.subsidy + Number(d.takeout_shop.distribution_price)));
                    }
                },
                error: function(d){
                    alert('错误：'+d);
                    console.log(d);
                    //window.history.go(-1);
                }
            });
        }
    });

    //显示地址
    function addressShow(data){
        var str = '';
        if(data){
            str = '<div class="order-address">\n'+
                '<p><span>收货人：</span><span>'+data.truename+'，'+data.mobile+'</span></p>\n'+
                '<p><span>收货地址：</span><span>'+data.address+'</span></p>\n'+
                '</div>\n'+
                '<div class="order-icon" onclick="openUrl()">\n'+
                '<i class="iconfont icon-right"></i>\n'+
                '</div>';
        }else{
            str = '<a href="javascript:openUrl();" class="address">请先添加地址</a>';
        }


        return str;
    }

    //显示菜单列表
    function showMenuList(data){
        var str = '';
        for(var i=0;i<data.cart_data.length;i++){
            if(data.cart_data[i].is_spec == 0){
                str += '<p><span style="font-size: 14px;max-width: 198px;position: relative;display: inline-block;">'+data.cart_data[i].dishes_name+'<b style="font-size: 1rem;color: #f0790f;position: absolute;top: 0;right: -22px;">x'+data.cart_data[i].goods_number+'</b></span><span>￥'+parseFloat(data.cart_data[i].sell_price)+'</span></p>';
            }else{
                for(var j=0;j<data.cart_data[i].spec_list.length;j++){
                    str += '<p><span style="font-size: 14px;max-width: 198px;position: relative;display: inline-block;">'+data.cart_data[i].dishes_name+'&nbsp;&nbsp;('+data.cart_data[i].spec_list[j].spec_name+')<b style="font-size: 1rem;color: #f0790f;position: absolute;top: 0;right: -22px;">x'+data.cart_data[i].spec_list[j].goods_number+'</b></span><span>￥'+parseFloat(data.cart_data[i].spec_list[j].sell_price)+'</span></p>';
                }
            }
        }
        return str;
    }

    //显示菜单内容
    function showDetails(data, discountPrice, shopName){
        var str = '', disPrice = 0;
        disPrice = discountPrice > 0 ? "-"+discountPrice : discountPrice;
        str += '<div class="shop-name"><i class="iconfont icon-shangpu"></i><span>'+decodeURIComponent(shopName)+'</span></div>\n' +
            '<div class="goods-name"></div>\n' +
            '<div class="distribution-money clearb">\n' +
            '<p><span>配送费</span><span class="right">￥'+data.distribution_price+'</span></p>\n' +
            '</div>\n' +
            '<div class="discount-money clearb">\n' +
            '<p><span>优惠金额</span><span class="right">￥'+disPrice+'</span></p>\n' +
            '</div>\n' +
            '<div class="remark">\n' +
            '<span>备注：</span>\n' +
            '<div>\n' +
            '<input type="text" name="note" placeholder="请在此填写需要备注的信息">\n' +
            '</div>\n' +
            '</div>\n' +
            '<div class="amount">\n' +
            '<p><span>共'+num+'件商品，小计</span><span>￥'+parseFloat(price - discountPrice + Number(data.distribution_price))+'</span></p>\n' +
            '</div>';
        return str;
    }

    //跳转修改地址链接
    function openUrl(){
        window.location.href = '/mobile/Address/address.html?Callback='+encodeURIComponent(window.location.href);
    }

    //提交表单数据
    function submitOrder(){
        var note = $("input[name='note']").val();
        $.ajax({
            url: '/mobile/for_ajax.php',
            type: 'POST',
            data: {for_ajax:'takeout_orders_add',takeout_id:id,buyer_name:name,buyer_phone:phone,buyer_address:address,note:note},
            dataType: "JSON",
            success: function(d){
                console.log(d);
                if(d.success){
                    window.location.href = '/mobile/Pay/ShoppingPay.html?oid='+d.data.order_id+'&state='+payType;
                }
            }
        });
    }
</script>
</body>
</html>